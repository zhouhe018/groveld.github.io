<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="format-detection" content="telephone=no">

  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-config" content="/browserconfig.xml">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Groveld">
  <meta name="theme-color" content="#1e88e5">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#1e88e5">

  <meta name="description" content="Install a ready to use Postfix mail server with MySql backend for virtual users.">
  <meta name="author" content="groveld">
  <link rel="alternate" type="application/atom+xml" title="Martin Groeneveld" href="/atom.xml">
  <link rel="canonical" href="https://www.groveld.com/articles/postfix-with-mysql-backend-and-tls">
  <title>Postfix with MySQL backend and TLS - Martin Groeneveld</title>

  <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/syntax.ea0db55.css">
  <link rel="stylesheet" href="/css/main.ea0db55.css">

  
<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-47976921-1', 'auto');
  ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</head>
<body>
  
<nav class="navbar fixed-top navbar-expand-lg navbar-light">
  <span class="navbar-brand mb-0 h1">
    <a class="d-inline-block mr-1" href="/">
      <img src="/images/logo.svg" width="30" height="30" class="d-inline-block align-top" alt="logo">
    </a>
    Martin Groeneveld
  </span>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbar">
    <div class="navbar-nav ml-auto">
      <a class="nav-item nav-link" href="/">Home</a>
      <a class="nav-item nav-link active" href="/archive">Archive</a>
      <a class="nav-item nav-link" href="/about">About</a>
    </div>
  </div>
</nav>


<header>
  <div class="container-fluid py-3 py-lg-5">
    <h1 class="my-0 py-0">Postfix with MySQL backend and TLS</h1>
  </div>
</header>



<main>
  <div class="container-fluid mt-3 mb-2 mt-lg-4 mb-lg-3">
    <div class="row">
      <div class="col">

        <p>In this tutorial we’ll install a ready to use Postfix mail server with MySql backend for virtual users. Notice that this tutorial only covers installing the SMTP server (not POP3 and IMAP). Click here for a tutorial on installing Courier POP3 and IMAP services.</p>

<p>Once installed and configured, you can easily create your own admin system to modifiy the domains and users because the table structure is very simple.</p>

<p>This tutorial has been tested on Debian etch and lenny</p>

<h3 id="install-the-postfix-mail-server-mysql-server-and-other-required-packages">Install the Postfix mail server, MySql server and other required packages</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get <span class="nb">install </span>postfix postfix-mysql sasl2-bin libsasl2-modules mysql-client mysql-server libpam-mysql
</code></pre></div></div>

<p>In the configuration wizzard for Postfix select and input the following;</p>

<p>General type of mail configuration <strong>-&gt;</strong> <code class="highlighter-rouge">Internet Site</code></p>

<p>System mail name <strong>-&gt;</strong> <code class="highlighter-rouge">server.domain.com</code> <em>(your server host name)</em></p>

<h3 id="create-a-mysql-database-that-will-contain-domains-and-mappings-and-create-a-user-that-has-read-privileges-on-it">Create a MySql database that will contain domains and mappings and create a user that has read privileges on it</h3>
<p>Execute the following SQL queries to create the table structure:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">domains</span> <span class="p">(</span>
<span class="k">domain</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">63</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="k">domain</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">MyISAM</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">forwardings</span> <span class="p">(</span>
<span class="n">email</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">destination</span> <span class="n">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">email</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">MyISAM</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">transport</span> <span class="p">(</span>
<span class="k">domain</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">transport</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="k">domain</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">MyISAM</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span> <span class="p">(</span>
<span class="n">email</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">password</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">quota</span> <span class="n">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">default</span> <span class="s1">'102400'</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">email</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">MyISAM</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="populate-tables-with-some-test-data">Populate tables with some test data</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">domains</span> <span class="p">(</span><span class="k">domain</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">mydomain</span><span class="p">.</span><span class="n">com</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">users</span> <span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'address@mydomain.com'</span><span class="p">,</span> <span class="n">ENCRYPT</span><span class="p">(</span><span class="s1">'mypassword'</span><span class="p">));</span>
<span class="n">INESRT</span> <span class="k">INTO</span> <span class="n">forwardings</span> <span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">desination</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'myforward@mydomain.com'</span><span class="p">,</span> <span class="s1">'address@mydomain.com, otheraddress@mydomain.com'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">transport</span> <span class="p">(</span><span class="k">domain</span><span class="p">,</span> <span class="n">transport</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'transport.com'</span><span class="p">,</span> <span class="s1">'smtp:mail.transport.com'</span><span class="p">);</span>
</code></pre></div></div>

<p>If you want to create a user or forwarding for a domain, you must add it to the domains table. Using the transport table you can forward all mail received to another mail server, when using the transport table you don’t have to add the domain to the domains table.</p>

<h3 id="create-mysql-mappings-for-postfix-replace-mysql_-with-your-mysql-credentials">Create MySql mappings for Postfix. Replace {mysql_*} with your MySql credentials</h3>
<p><code class="highlighter-rouge">nano /etc/postfix/mysql-virtual_domains.cf</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hosts</span> = {<span class="n">mysql_host</span>}
<span class="n">user</span> = {<span class="n">mysql_username</span>}
<span class="n">password</span> = {<span class="n">mysql_password</span>}
<span class="n">dbname</span> = {<span class="n">mysql_database</span>}
<span class="n">table</span> = <span class="n">domains</span>
<span class="n">select_field</span> = <span class="s1">'virtual'</span>
<span class="n">where_field</span> = <span class="n">domain</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">nano /etc/postfix/mysql-virtual_forwardings.cf</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hosts</span> = {<span class="n">mysql_host</span>}
<span class="n">user</span> = {<span class="n">mysql_username</span>}
<span class="n">password</span> = {<span class="n">mysql_password</span>}
<span class="n">dbname</span> = {<span class="n">mysql_database</span>}
<span class="n">table</span> = <span class="n">forwardings</span>
<span class="n">select_field</span> = <span class="n">destination</span>
<span class="n">where_field</span> = <span class="n">email</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">nano /etc/postfix/mysql-virtual_mailboxes.cf</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hosts</span> = {<span class="n">mysql_host</span>}
<span class="n">user</span> = {<span class="n">mysql_username</span>}
<span class="n">password</span> = {<span class="n">mysql_password</span>}
<span class="n">dbname</span> = {<span class="n">mysql_database</span>}
<span class="n">table</span> = <span class="n">users</span>
<span class="n">select_field</span> = <span class="n">CONCAT</span>(<span class="n">SUBSTRING_INDEX</span>(<span class="n">email</span>,<span class="s1">'@'</span>,-<span class="m">1</span>),<span class="s1">'/'</span>,<span class="n">SUBSTRING_INDEX</span>(<span class="n">email</span>,<span class="s1">'@'</span>,<span class="m">1</span>),<span class="s1">'/'</span>)
<span class="n">where_field</span> = <span class="n">email</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">nano /etc/postfix/mysql-virtual_email2email.cf</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hosts</span> = {<span class="n">mysql_host</span>}
<span class="n">user</span> = {<span class="n">mysql_username</span>}
<span class="n">password</span> = {<span class="n">mysql_password</span>}
<span class="n">dbname</span> = {<span class="n">mysql_database</span>}
<span class="n">table</span> = <span class="n">users</span>
<span class="n">select_field</span> = <span class="n">email</span>
<span class="n">where_field</span> = <span class="n">email</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">nano /etc/postfix/mysql-virtual_transports.cf</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hosts</span> = {<span class="n">mysql_host</span>}
<span class="n">user</span> = {<span class="n">mysql_username</span>}
<span class="n">password</span> = {<span class="n">mysql_password</span>}
<span class="n">dbname</span> = {<span class="n">mysql_database</span>}
<span class="n">table</span> = <span class="n">transport</span>
<span class="n">select_field</span> = <span class="n">transport</span>
<span class="n">where_field</span> = <span class="n">domain</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">nano /etc/postfix/mysql-virtual_mailbox_limit_maps.cf</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hosts</span> = {<span class="n">mysql_host</span>}
<span class="n">user</span> = {<span class="n">mysql_username</span>}
<span class="n">password</span> = {<span class="n">mysql_password</span>}
<span class="n">dbname</span> = {<span class="n">mysql_database</span>}
<span class="n">table</span> = <span class="n">users</span>
<span class="n">select_field</span> = <span class="n">quota</span>
<span class="n">where_field</span> = <span class="n">email</span>
</code></pre></div></div>

<h3 id="set-correct-permissions-on-the-newly-created-files-and-allow-postfix-to-read-the-files">Set correct permissions on the newly created files and allow Postfix to read the files</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>640 /etc/postfix/mysql-virtual_<span class="k">*</span>
<span class="nb">chgrp </span>postfix /etc/postfix/mysql-virtual_<span class="k">*</span>
</code></pre></div></div>

<h3 id="create-a-new-user-and-group-named-vmail-all-incoming-mail-will-be-stored-in-this-users-home-directory">Create a new user and group named vmail. All incoming mail will be stored in this users home directory</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>groupadd <span class="nt">-g</span> 5000 vmail
useradd <span class="nt">-g</span> vmail <span class="nt">-u</span> 5000 vmail <span class="nt">-d</span> /home/vmail <span class="nt">-m</span>
</code></pre></div></div>

<h3 id="configure-postfix-to-use-sasl-for-user-authentication-and-tls-for-encryption">Configure Postfix to use SASL for user authentication and TLS for encryption</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postconf <span class="nt">-e</span> <span class="s1">'smtpd_sasl_auth_enable = yes'</span>
postconf <span class="nt">-e</span> <span class="s1">'broken_sasl_auth_clients = yes'</span>
postconf <span class="nt">-e</span> <span class="s1">'smtpd_recipient_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination'</span>
postconf <span class="nt">-e</span> <span class="s1">'smtpd_use_tls = yes'</span>
postconf <span class="nt">-e</span> <span class="s1">'smtpd_tls_cert_file = /etc/postfix/smtpd.cert'</span>
postconf <span class="nt">-e</span> <span class="s1">'smtpd_tls_key_file = /etc/postfix/smtpd.key'</span>
postconf <span class="nt">-e</span> <span class="s1">'smtpd_sasl_local_domain = $myhostname'</span>
postconf <span class="nt">-e</span> <span class="s1">'smtpd_sasl_security_options = noanonymous'</span>
</code></pre></div></div>

<h3 id="configure-postfix-to-use-the-mysql-database-to-find-virtual-users-where-to-store-mail-and-what-to-do-for-users-over-quota">Configure Postfix to use the MySql database to find virtual users, where to store mail and what to do for users over quota</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postconf <span class="nt">-e</span> <span class="s1">'virtual_alias_domains ='</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_alias_maps = proxy:mysql:/etc/postfix/mysql-virtual_forwardings.cf, mysql:/etc/postfix/mysql-virtual_email2email.cf'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_mailbox_domains = proxy:mysql:/etc/postfix/mysql-virtual_domains.cf'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_mailbox_maps = proxy:mysql:/etc/postfix/mysql-virtual_mailboxes.cf'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_mailbox_base = /home/vmail'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_uid_maps = static:5000'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_gid_maps = static:5000'</span>
postconf <span class="nt">-e</span> <span class="s1">'transport_maps = proxy:mysql:/etc/postfix/mysql-virtual_transports.cf'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_create_maildirsize = yes'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_mailbox_extended = yes'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_mailbox_limit_maps = proxy:mysql:/etc/postfix/mysql-virtual_mailbox_limit_maps.cf'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_mailbox_limit_override = yes'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_maildir_limit_message = "The user you are trying to reach is over quota."'</span>
postconf <span class="nt">-e</span> <span class="s1">'virtual_overquota_bounce = yes'</span>
postconf <span class="nt">-e</span> <span class="s1">'proxy_read_maps = $local_recipient_maps $mydestination $virtual_alias_maps $virtual_alias_domains $virtual_mailbox_maps $virtual_mailbox_domains $relay_recipient_maps $relay_domains $canonical_maps $sender_canonical_maps $recipient_canonical_maps $relocated_maps $transport_maps $mynetworks $virtual_mailbox_limit_maps'</span>
</code></pre></div></div>

<h3 id="create-a-self-signed-certificate-to-encrypt-connections">Create a self signed certificate to encrypt connections</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req <span class="nt">-new</span> <span class="nt">-outform</span> PEM <span class="nt">-out</span> /etc/postfix/smtpd.cert <span class="nt">-newkey</span> rsa:2048 <span class="nt">-nodes</span> <span class="nt">-keyout</span> /etc/postfix/smtpd.key <span class="nt">-keyform</span> PEM <span class="nt">-days</span> 3650 <span class="nt">-x509</span>
<span class="nb">chmod </span>640 /etc/postfix/smtpd.key
</code></pre></div></div>

<h3 id="make-postfix-listen-on-port-465-for-secure-smtp-connections">Make Postfix listen on port 465 for secure smtp connections</h3>
<p><code class="highlighter-rouge">nano /etc/postfix/master.cf</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">smtps</span> <span class="n">inet</span> <span class="n">n</span> - - - - <span class="n">smtpd</span>
-<span class="n">o</span> <span class="n">smtpd_tls_wrappermode</span>=<span class="n">yes</span>
-<span class="n">o</span> <span class="n">smtpd_sasl_auth_enable</span>=<span class="n">yes</span>
-<span class="n">o</span> <span class="n">smtpd_client_restrictions</span>=<span class="n">permit_sasl_authenticated</span>,<span class="n">reject</span>
</code></pre></div></div>

<h3 id="force-sasl-to-store-the-pid-files-in-a-location-where-postfix-can-read-them">Force SASL to store the PID files in a location where Postfix can read them</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /var/spool/postfix/var/run/saslauthd
</code></pre></div></div>

<p>Edit SASL config to enable the daemon and make it use the new PID file location (<code class="highlighter-rouge">nano /etc/default/saslauthd</code>)</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">START</span>=<span class="n">yes</span>
<span class="n">OPTIONS</span>=<span class="s2">"-c -m /var/spool/postfix/var/run/saslauthd -r"</span>
</code></pre></div></div>

<p>Edit the init file for SASL (<code class="highlighter-rouge">nano /etc/init.d/saslauthd</code>)</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PIDFILE</span>=<span class="s2">"/var/spool/postfix/var/run/${NAME}/saslauthd.pid"</span>
</code></pre></div></div>

<h3 id="insert-mysql-credentials-for-pam-nano-etcpamdsmtp">Insert MySql credentials for PAM (nano /etc/pam.d/smtp)**</h3>
<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">auth</span> <span class="n">required</span> <span class="n">pam_mysql</span>.<span class="n">so</span> <span class="n">user</span>={<span class="n">mysql_username</span>} <span class="n">passwd</span>={<span class="n">mysql_password</span>} <span class="n">host</span>={<span class="n">mysql_host</span>} <span class="n">db</span>={<span class="n">mysql_database</span>} <span class="n">table</span>=<span class="n">users</span> <span class="n">usercolumn</span>=<span class="n">email</span> <span class="n">passwdcolumn</span>=<span class="n">password</span> <span class="n">crypt</span>=<span class="m">1</span>
<span class="n">account</span> <span class="n">sufficient</span> <span class="n">pam_mysql</span>.<span class="n">so</span> <span class="n">user</span>={<span class="n">mysql_username</span>} <span class="n">passwd</span>={<span class="n">mysql_password</span>} <span class="n">host</span>={<span class="n">mysql_host</span>} <span class="n">db</span>={<span class="n">mysql_database</span>} <span class="n">table</span>=<span class="n">users</span> <span class="n">usercolumn</span>=<span class="n">email</span> <span class="n">passwdcolumn</span>=<span class="n">password</span> <span class="n">crypt</span>=<span class="m">1</span>
</code></pre></div></div>

<h3 id="config-sasl-for-postfix-and-specify-mysql-credentials">Config SASL for Postfix and specify MySql credentials</h3>
<p><code class="highlighter-rouge">nano /etc/postfix/sasl/smtpd.conf</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pwcheck_method</span>: <span class="n">saslauthd</span>
<span class="n">mech_list</span>: <span class="n">plain</span> <span class="n">login</span>
<span class="n">allow_plaintext</span>: <span class="n">true</span>
<span class="n">auxprop_plugin</span>: <span class="n">mysql</span>
<span class="n">sql_hostnames</span>: {<span class="n">mysql_host</span>}
<span class="n">sql_user</span>: {<span class="n">mysql_username</span>}
<span class="n">sql_passwd</span>: {<span class="n">mysql_password</span>}
<span class="n">sql_database</span>: {<span class="n">mysql_database</span>}
<span class="n">sql_select</span>: <span class="n">select</span> <span class="n">password</span> <span class="n">from</span> <span class="n">users</span> <span class="n">where</span> <span class="n">email</span> = <span class="s1">'%u'</span>
</code></pre></div></div>

<h3 id="add-the-postfix-user-to-the-sasl-group-allowing-postfix-to-communicate-with-sasl">Add the Postfix user to the SASL group allowing Postfix to communicate with SASL</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adduser postfix sasl
</code></pre></div></div>

<h3 id="restart-postfix-and-sasl">Restart Postfix and SASL</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/init.d/postfix restart
/etc/init.d/saslauthd restart
</code></pre></div></div>

<p>You’re all done. Now you can connect to ports 25 and 465 to sent mails to your virtual users specified in the MySql database. When authenticating with your e-mail client, use the full e-mail address as the username.</p>


      </div>
    </div>
  </div>
</main>

<footer>
  <div class="container-fluid">
    <p class="small text-center my-0">&copy; 2019 Martin Groeneveld &bull; <a href="/terms">Terms</a> &bull; <a href="/privacy">Privacy</a></p>
  </div>
</footer>



  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  <script src="/js/vhfix.ea0db55.js"></script>
  <script src="/js/main.ea0db55.js"></script>
</body>
</html>
