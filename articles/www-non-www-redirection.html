<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="format-detection" content="telephone=no">

  <link rel="dns-prefetch" href="//code.jquery.com">
  <link rel="dns-prefetch" href="//fonts.googleapis.com">

  <link rel="shortcut icon" href="/favicon.ico">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#2b5797">
  <meta name="msapplication-config" content="/browserconfig.xml">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Groveld">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#f00">

  <meta name="description" content="Force users to use either the WWW version or non-WWW version of URLs for your site.">
  <meta name="author" content="groveld">
  <link rel="alternate" type="application/atom+xml" title="Martin Groeneveld" href="/atom.xml">
  <link rel="canonical" href="https://www.groveld.com/articles/www-non-www-redirection">
  <title>Nginx config for www and non-www redirection - Martin Groeneveld</title>
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/syntax-one-dark-vivid.css">
  <link rel="stylesheet" href="/css/main.7ea6286.css">
</head>
<body>
  
<nav class="navbar fixed-top navbar-expand-lg navbar-light d-print-none">

  <span class="navbar-brand mb-0 font-weight-bold">
    <a class="d-inline-block mr-1" href="/">
      <img src="/images/logo.svg" width="30" height="30" class="d-inline-block align-top" alt="logo">
    </a>
    Martin Groeneveld
  </span>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbar">
    <div class="navbar-nav ml-auto small font-weight-bold">
      <a class="nav-item nav-link" href="/terms">Terms</a>
      <a class="nav-item nav-link" href="/privacy">Privacy</a>
      <a class="nav-item nav-link active" href="/">Articles</a>
      <a class="nav-item nav-link" href="/about">About</a>
    </div>
  </div>

  <progress id="reading-progress" class="progress" value="0" max="100">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>

</nav>


<main>

  <div class="container-fluid mb-3 mb-lg-5">
    <div class="row">
      <div class="col">

        
        <header>
          <div class="container-fluid text-center py-3 py-lg-5">
            <h1 class="m-0">Nginx config for www and non-www redirection</h1>
            <p class="text-muted m-0">January 16, 2015 - groveld</p>
          </div>
        </header>
        

        <p>There are many ways to force Nginx to use either WWW version or non-WWW version of URLs for your site.</p>

<h2 id="redirect-non-www-to-www">Redirect non-www to WWW</h2>

<h3 id="single-domain">Single domain</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">example.com</span><span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//www.example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="all-domains">All domains</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">"~^(?!www</span><span class="err">\</span><span class="s">.).*"</span> <span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//www.</span><span class="nv">$host$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="from-www-to-non-www">From WWW to non-WWW</h2>

<h3 id="single-domain-1">Single domain</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">www.example.com</span><span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="all-domains-1">All domains</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">"~^www</span><span class="err">\</span><span class="s">.(.*)</span>$<span class="s">"</span> <span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//</span><span class="nv">$1$request_uri</span> <span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In both cases, for other-www, we create a altogether different server { } block. IMHO, this is cleanest and optimised way to handle www to non-www and non-www to www redirection.</p>

<p>There are some WordPress plugins available there which can handle this at PHP-level. But for performance reason, always handle things in Nginx, that can be handled in Nginx alone!</p>


      </div>
    </div>
  </div>

  <!-- <div class="post-nav">
    
      <a class="prev-post" href="/articles/give-user-permission-to-edit-and-add-files-in-var-www">&laquo; Give user permission to edit and add files in /var/www</a>
    
    
      <a class="next-post" href="/articles/htaccess-snippets">A collection of useful .htaccess snippets &raquo;</a>
    
  </div> -->

</main>


  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="/js/main.7ea6286.js"></script>
</body>
</html>
