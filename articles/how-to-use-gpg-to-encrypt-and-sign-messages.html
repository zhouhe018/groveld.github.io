<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"><meta name="format-detection" content="telephone=no"><link rel="preconnect" href="//cdnjs.cloudflare.com"><link rel="preconnect" href="//code.jquery.com"><link rel="shortcut icon" href="/favicon.ico"><meta name="mobile-web-app-capable" content="yes"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#2b5797"><meta name="msapplication-config" content="/browserconfig.xml"><meta name="msapplication-TileColor" content="#2b5797"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Groveld"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/img/logo.svg" color="#f00"><meta name="description" content="How GPG works and how to implement it."><meta name="keywords" content="linux, GPG"><meta name="author" content="groveld"><meta name="robots" content="index, follow"><link rel="alternate" type="application/atom+xml" title="Martin Groeneveld" href="/atom.xml"><link rel="canonical" href="https://www.groveld.com/articles/how-to-use-gpg-to-encrypt-and-sign-messages"><title>How To Use GPG to Encrypt and Sign Messages - Martin Groeneveld</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link href="https://fonts.googleapis.com/css?family=Fira+Sans:400,700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/syntax.fc5d842.css"><link rel="stylesheet" href="/css/main.fc5d842.css"></head><body><nav class="navbar fixed-top navbar-expand-lg navbar-light d-print-none"> <span class="navbar-brand mb-0 font-weight-bold"> <a class="d-inline-block mr-1" href="/"> <img src="/img/logo.svg" width="30" height="30" class="d-inline-block align-top" alt="logo"> </a> Martin Groeneveld </span> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button><div class="collapse navbar-collapse" id="navbar"><div class="navbar-nav ml-auto small font-weight-bold"> <a class="nav-item nav-link active" href="/">Articles</a> <a class="nav-item nav-link" href="/about">About</a></div></div><progress id="reading-progress" class="progress" value="0" max="100"><div class="progress-container"> <span class="progress-bar"></span></div></progress></nav><main><div class="container-fluid mb-3 mb-lg-5"><div class="row"><div class="col"><header><h1 class="m-0">How To Use GPG to Encrypt and Sign Messages</h1><p class="m-0">Posted on <time class="font-weight-bold">15 February 2014</time></p></header><p>GPG, or GNU Privacy Guard, is a public key cryptography implementation. This allows for the secure transmission of information between parties and can be used to verify that the origin of a message is genuine.</p><p>In this guide, we will discuss how GPG works and how to implement it. We will be using an Ubuntu 12.04 VPS for this demonstration, but the tools are available on any modern Linux distribution.</p><h2 id="how-public-key-encryption-works">How Public Key Encryption Works</h2><p>A problem that many users face is how to communicate securely and validate the identity of the party they are talking to. Many schemes that attempt to answer this question require, at least at some point, the transfer of a password or other identifying credentials, over an insecure medium.</p><h3 id="ensure-that-only-the-intended-party-can-read">Ensure That Only the Intended Party Can Read</h3><p>To get around this issue, GPG relies on a security concept known as public key encryption. The idea is that you can split the encrypting and decrypting stages of the transmission into two separate pieces. That way, you can freely distribute the encrypting portion, as long as you secure the decrypting portion.</p><p>This would allow for a one-way message transfer that can be created and encrypted by anyone, but only be decrypted by the designated user (the one with the private decrypting key). If both of the parties create public/private key pairs and give each other their public encrypting keys, they can both encrypt messages to each other.</p><p>So in this scenario, each party has their own private key and the other user’s public key.</p><h3 id="validate-the-identity-of-the-sender">Validate the Identity of the Sender</h3><p>Another benefit of this system is that the sender of a message can “sign” the message with their private key. The public key that the receiver has can be used to verify that the signature is actually being sent by the indicated user.</p><p>This can prevent a third-party from “spoofing” the identity of someone. It also helps to ensure that the message was transmitted in-full, without damage or file corruption.</p><h2 id="set-up-gpg-keys">Set Up GPG Keys</h2><p>GPG should be installed by default on Ubuntu 12.04. If it is not, you can install it with:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>gnupg
</code></pre></div></div><p>To begin using GPG to encrypt your communications, you need to create a key pair. You can do this by issuing the following command:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--gen-key</span>
</code></pre></div></div><p>This will take you through a few questions that will configure your keys.</p><ul><li>Please select what kind of key you want: <em>(1) RSA and RSA (default)</em></li><li>What keysize do you want? <em>4096</em></li><li>Key is valid for? <em>0</em></li><li>Is this correct? <em>y</em></li><li>Real name: <em>your real name here</em></li><li>Email address: <em>your_email@address.com</em></li><li>Comment: <em>Optional comment that will be visible in your signature</em></li><li>Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? <em>O</em></li><li>Enter passphrase: <em>Enter a secure passphrase here</em></li></ul><p>At this point, it will need to generate the keys using entropy. This is basically a term to describe the amount of unpredictability that exists in a system. GPG uses this entropy to generate a random set of keys.</p><p>It is best to open a new terminal and ssh into the VPS while this runs. Install some software, do some work, and just use the machine as much as possible to let it generate the needed entropy.</p><p>This process may take a long time, depending on how active you can make your system.</p><h3 id="create-a-revocation-certificate">Create a Revocation Certificate</h3><p>You need to have a way of invalidating your key pair in case there is a security breach, or in case you lose your secret key. There is an easy way of doing this with the GPG software.</p><p>This should be done as soon as you make the key pair, not when you need it. This revocation key must be generated ahead of time and kept in a secure, separate location in case your computer is compromised or inoperable. Type:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--gen-revoke</span> your_email@address.com
</code></pre></div></div><p>You will be asked for the reason that it is being revoked. You can choose any of the available options, but since this is being done ahead of time, you won’t have the specifics.</p><p>You will then be offered to supply a comment and finally, to confirm the selections.</p><p>Afterwards, a revocation certificate will be generated to the screen. Copy and paste this to a secure location, or print it for later use:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Revocation certificate created.

Please move it to a medium which you can hide away<span class="p">;</span> <span class="k">if </span>Mallory gets
access to this certificate he can use it to make your key unusable.
It is smart to print this certificate and store it away, just <span class="k">in case</span>
your media become unreadable.  But have some caution:  The print system of
your machine might store the data and make it available to others!
<span class="nt">-----BEGIN</span> PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.11 <span class="o">(</span>GNU/Linux<span class="p">)</span>
Comment: A revocation certificate should follow

iQIfBCABAgAJBQJSTxNSAh0AAAoJEIKHahUxGx+E15EP/1BL2pCTqSG9IYbz4CMN
bCW9HgeNpb24BK9u6fAuyH8aieLVD7It80LnSg/+PgG9t4KlzUky5sOoo54Qc3rD
H+JClu4oaRpq25vWd7+Vb2oOwwd/27Y1KRt6TODwK61z20XkGPU2NJ/ATPn9yIR9
4B10QxqqQSpQeB7rr2+Ahsyl5jefswwXmduDziZlZqf+g4lv8lZlJ8C3+GKv06fB
FJwE6XO4Y69LNAeL+tzSE9y5lARKVMfqor/wS7lNBdFzo3BE0w68HN6iD+nDbo8r
xCdQ9E2ui9os/5yf9Y3Uzky1GTLmBhTqPnl8AOyHHLTqqOT47arpwRXXDeNd4B7C
DiE0p1yevG6uZGfhVAkisNfi4VrprTx73NGwyahCc3gO/5e2GnKokCde/NhOknci
Wl4oSL/7a3Wx8h/XKeNvkiurInuZugFnZVKbW5kvIbHDWJOanEQnLJp3Q2tvebrr
BBHyiVeQiEwOpFRvBuZW3znifoGrIc7KMmuEUPvA243xFcRTO3G1D1X9B3TTSlc/
o8jOlv6y2pcdBfp4aUkFtunE4GfXmIfCF5Vn3TkCyBV/Y2aW/fpA3Y+nUy5hPhSt
tprTYmxyjzSvaIw5tjsgylMZ48+qp/Awe34UWL9AWk3DvmydAerAxLdiK/80KJp0
88qdrRRgEuw3qfBJbNZ7oM/o
<span class="o">=</span>isbs
<span class="nt">-----END</span> PGP PUBLIC KEY BLOCK-----
</code></pre></div></div><h2 id="how-to-import-other-users-public-keys">How To Import Other Users’ Public Keys</h2><p>GPG would be pretty useless if you could not accept other public keys from people you wished to communicate with.</p><p>You can import someone’s public key in a variety of ways. If you’ve obtained a public key from someone in a text file, GPG can import it with the following command:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--import</span> name_of_pub_key_file
</code></pre></div></div><p>There is also the possibility that the person you are wishing to communicate with has uploaded their key to a public key server. These key servers are used to house people’s public keys from all over the world.</p><p>A popular key server that syncs its information with a variety of other servers is the MIT public key server. You can search for people by their name or email address by going here in your web browser:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://pgp.mit.edu/
</code></pre></div></div><p>You can also search the key server from within GPG by typing the following:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--keyserver</span> pgp.mit.edu  <span class="nt">--search-keys</span> search_parameters
</code></pre></div></div><h2 id="how-to-verify-and-sign-keys">How To Verify and Sign Keys</h2><p>While you can freely distribute your generated public key file and people can use this to contact you in an encrypted way, there is still an issue of trust in the initial public key transmission.</p><h3 id="verify-the-other-persons-identity">Verify the Other Person’s Identity</h3><p>How do you know that the person giving you the public key is who they say they are? In some cases, this may be simple. You may be sitting right next to the person with your laptops both open and exchanging keys. This should be a pretty secure way of identifying that you are receiving the correct, legitimate key.</p><p>But there are many other circumstances where such personal contact is not possible. You may not know the other party personally, or you may be separated by physical distance. If you never want to communicate over insecure channels, verification of the public key could be problematic.</p><p>Luckily, instead of verifying the entire public keys of both parties, you can simply compare the “fingerprint” derived from these keys. This will give you a reasonable assurance that you both are using the same public key information.</p><p>You can get the fingerprint of a public key by typing:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--fingerprint</span> your_email@address.com
</code></pre></div></div><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pub   4096R/311B1F84 2013-10-04
      Key fingerprint <span class="o">=</span> CB9E C70F 2421 AF06 7D72  F980 8287 6A15 311B 1F84
uid                  Test User &lt;test.user@address.com&gt;
sub   4096R/8822A56A 2013-10-04
</code></pre></div></div><p>This will produce a much more manageable string of numbers to compare. You can compare this string with the person themselves, or someone else who has access to that person.</p><h3 id="sign-their-key">Sign Their Key</h3><p>Signing a key tells your software that you trust the key that you have been provided with and that you have verified that it is associated with the person in question.</p><p>To sign a key that you’ve imported, simply type:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--sign-key</span> email@example.com
</code></pre></div></div><p>After you’ve signed the key, it means you verify that you trust the person is who he/she claims to be. This can help other people decide whether to trust that person too. If someone trusts you, and they see that you’ve signed this person’s key, they may be more likely to trust their identity too.</p><p>You should allow the person whose key you are signing the advantages of your trusted relationship by sending them back the signed key. You can do this by typing:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--export</span> <span class="nt">--armor</span> email@example.com
</code></pre></div></div><p>You’ll have to type in your passphrase again. Afterwards, their public key, signed by you, will be spit out on the screen. Send them this, so that they can benefit from gaining your “stamp of approval” when interacting with others.</p><p>When they receive this new, signed key, they can import it, adding on the signing information you’ve generated, into their GPG database. They can do this by typing:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--import</span> file_name
</code></pre></div></div><h2 id="how-to-make-your-public-key-highly-available">How To Make Your Public Key Highly Available</h2><p>There is not really anything malicious that can happen if unknown people have your public key.</p><p>Because of this, it may be beneficial to make your public key easily available. People can then easily find your information to send you secure messages, from the very first communication.</p><p>You can send anyone your public key by requesting it from the GPG system:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--armor</span> <span class="nt">--export</span> your_email@address.com
</code></pre></div></div><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-----BEGIN</span> PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.11 <span class="o">(</span>GNU/Linux<span class="o">)</span>

mQINBFJPCuABEACiog/sInjg0O2SqgmG1T8n9FroSTdN74uGsRMHHAOuAmGLsTse
9oxeLQpN+r75Ko39RVE88dRcW710fPY0+fjSXBKhpN+raRMUKJp4AX9BJd00YA/4
EpD+8cDK4DuLlLdn1x0q41VUsznXrnMpQedRmAL9f9bL6pbLTJhaKeorTokTvdn6
5VT3pb2o+jr6NETaUxd99ZG/osPar9tNThVLIIzG1nDabcTFbMB+w7wOJuhXyTLQ
JBU9xmavTM71PfV6Pkh4j1pfWImXc1D8dS+jcvKeXInBfm2XZsfOCesk12YnK3Nc
u1Xe1lxzSt7Cegum4S/YuxmYoh462oGZ7FA4Cr2lvAPVpO9zmgQ8JITXiqYg2wB3
<span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span>
</code></pre></div></div><p>You can then copy and paste this or send this in an appropriate medium.</p><p>If you want to publish your key to a key server, you can do it manually through the forms available on most of the server sites.</p><p>Another option is to do this through the GPG interface.</p><p>Look up your key ID by typing:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--list-keys</span> your_email@address.com
</code></pre></div></div><p>The highlighted portion is your key ID. It is a short way to reference the key to the internal software.</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pub   4096R/311B1F84 2013-10-04
uid                  Test User &lt;test.user@address.com&gt;
sub   4096R/8822A56A 2013-10-04
</code></pre></div></div><p>To upload your key to a certain key server, you can then use this syntax:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--send-keys</span> <span class="nt">--keyserver</span> pgp.mit.edu key_id
</code></pre></div></div><h3 id="encrypt-and-decrypt-messages-with-gpg">Encrypt and Decrypt Messages with GPG</h3><p>You can easily encrypt and decrypt messages after you have configured your keys with the other party.</p><h3 id="encrypt-messages">Encrypt Messages</h3><p>You can encrypt messages using the “–encrypt” flag for GPG. The basic syntax would be:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--encrypt</span> <span class="nt">--sign</span> <span class="nt">--armor</span> <span class="nt">-r</span> person@email.com name_of_file
</code></pre></div></div><p>The parameters basically encrypt the email, sign it with your private key to guarantee that it is coming from you, and generates the message in a text format instead of raw bytes.</p><p>You should also include a second “-r” recipient with your own email address if you want to be able to read the message ever. This is because the message will be encrypted with each person’s public key, and will only be able to be decrypted with the associated private key.</p><p>So if it was only encrypted with the other party’s public key, you would not be able to view the message again, unless you somehow obtained their private key. Adding yourself as a second recipient encrypts the message two separate times, one for each recipient.</p><h3 id="decrypt-messages">Decrypt Messages</h3><p>When you receive a message, simply call GPG on the message file:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg file_name
</code></pre></div></div><p>The software will prompt you as necessary.</p><p>If you have the message as a raw text stream, you can copy and paste it after you just typing <code class="highlighter-rouge">gpg</code> without any arguments. You can press “CTRL-D” to signify the end of the message and GPG will decrypt it for you.</p><h2 id="key-maintenance">Key Maintenance</h2><p>There are a number of procedures that you may need to use on a regular basis to manage your key database.</p><p>To list your available GPG keys that you have from other people, you can issue this command:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--list-keys</span>
</code></pre></div></div><p>Your key information can become outdated if you are relying on information pulled from public key servers. You do not want to be relying on revoked keys, because that would mean you are trusting potentially compromised keys.</p><p>You can update the key information by issuing:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--refresh-keys</span>
</code></pre></div></div><p>This will fetch new information from the key servers.</p><p>You can pull information from a specific key server by using:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--keyserver</span> key_server <span class="nt">--refresh-keys</span>
</code></pre></div></div><h2 id="conclusion">Conclusion</h2><p>Using GPG correctly can help you secure your communications with different people. This is extremely helpful, especially when dealing with sensitive information, but also when dealing with regular, every day messaging.</p><p>Because of the way that certain encrypted communications can be flagged by monitoring programs, it is recommended to use encryption for everything, not just “secret” data. That will make it more difficult for people to know when you are sending important data or just sending a friendly hello.</p><p>GPG encryption is only useful when both parties use good security practices and are vigilant about their other security practices. Educate those who you communicate regularly with about the importance of these practices if you want to have the possibility of cryptographically secure communication.</p></div></div></div></main><script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script> <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script> <script src="/js/main.fc5d842.js"></script></body></html>