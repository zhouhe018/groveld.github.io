<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta name="format-detection" content="telephone=no"><link rel="apple-touch-icon" sizes="180x180" href="/static/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" href="/static/favicons/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/static/favicons/favicon-194x194.png" sizes="194x194"><link rel="icon" type="image/png" href="/static/favicons/android-chrome-192x192.png" sizes="192x192"><link rel="icon" type="image/png" href="/static/favicons/favicon-16x16.png" sizes="16x16"><link rel="manifest" href="/static/manifest.json"><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#000"><link rel="shortcut icon" href="/static/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Groveld"><meta name="application-name" content="Groveld"><meta name="msapplication-config" content="/static/browserconfig.xml"><meta name="theme-color" content="#000"><meta name="description" content="The personal website of Martin Groeneveld"><meta name="author" content="groveld"><link rel="alternate" title="Martin Groeneveld" href="/atom.xml"><link rel="canonical" href="https://www.groveld.com/articles/www-non-www-redirection/"><title>Nginx config for www and non-www redirection &bull; Martin Groeneveld</title><link rel="author" href="https://plus.google.com/u/0/+MartinGroeneveldGroveld"><link rel="publisher" href="https://plus.google.com/u/0/+MartinGroeneveldGroveld"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@groveld"><meta name="twitter:url" content="https://www.groveld.com/articles/www-non-www-redirection/"><meta name="twitter:image" content="/static/images/share.png"><meta name="twitter:title" content="Nginx config for www and non-www redirection"><meta name="twitter:description" content="The personal website of Martin Groeneveld"><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet"><link rel="stylesheet" href="/static/css/5144fa7c240f10a938aa602665286cab88e986c1.css"> <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script> <![endif]--><body><nav class="navbar navbar-default navbar-fixed-top hidden-print"><div class="container"><div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Martin Groeneveld</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/">Home</a><li><a href="/about/">About</a><li><a href="/contact/">Contact</a></ul></div></div></nav><section id="post"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><h1 class="post-title">Nginx config for www and non-www redirection</h1><h2 class="post-subtitle"><a href="https://github.com/groveld">groveld</a> on 16 Jan 2015</h2></div></div><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article><p>There are many ways to force Nginx to use either WWW version or non-WWW version of URLs for your site.<h2 id="redirect-non-www-to-www">Redirect non-www to WWW</h2><h3 id="single-domain">Single domain</h3><div class="language-nginx highlighter-rouge"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">example.com</span><span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//www.example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h3 id="all-domains">All domains</h3><div class="language-nginx highlighter-rouge"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">"~^(?!www</span><span class="err">\</span><span class="s">.).*"</span> <span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//www.</span><span class="nv">$host$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="from-www-to-non-www">From WWW to non-WWW</h2><h3 id="single-domain-1">Single domain</h3><div class="language-nginx highlighter-rouge"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">www.example.com</span><span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h3 id="all-domains-1">All domains</h3><div class="language-nginx highlighter-rouge"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">"~^www</span><span class="err">\</span><span class="s">.(.*)</span>$<span class="s">"</span> <span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//</span><span class="nv">$1$request_uri</span> <span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>In both cases, for other-www, we create a altogether different server { } block. IMHO, this is cleanest and optimised way to handle www to non-www and non-www to www redirection.<p>There are some WordPress plugins available there which can handle this at PHP-level. But for performance reason, always handle things in Nginx, that can be handled in Nginx alone!</article></div></div><div class="row hidden-print"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div id="share" class="btn-group btn-group-justified" role="group"> <a href="http://reddit.com/submit?url=/articles/www-non-www-redirection/&title=Nginx config for www and non-www redirection" class="btn btn-reddit" role="button"><span class="fa fa-reddit-alien"></span></a> <a href="https://plus.google.com/share?url=/articles/www-non-www-redirection/" class="btn btn-googleplus" role="button"><span class="fa fa-google-plus"></span></a> <a href="http://www.linkedin.com/shareArticle?url=/articles/www-non-www-redirection/&title=Nginx config for www and non-www redirection&summary=SUMMARY&source=SOURCE_URL" class="btn btn-linkedin" role="button"><span class="fa fa-linkedin"></span></a> <a href="http://twitter.com/share?url=/articles/www-non-www-redirection/&text=TEXT&via=USERNAME" class="btn btn-twitter" role="button"><span class="fa fa-twitter"></span></a> <a href="http://www.facebook.com/sharer/sharer.php?u=/articles/www-non-www-redirection/" class="btn btn-facebook" role="button"><span class="fa fa-facebook"></span></a></div><ul class="pager"><li class="previous"><a href="/articles/give-user-permission-to-edit-and-add-files-in-var-www/">&larr; Previous article</a><li class="next"><a href="/articles/htaccess-snippets/">Next article &rarr;</a></ul></div></div></div></section><footer class="hidden-print"><div class="container"><p class="text-center">Copyright &copy; Martin Groeneveld 2017 &bull; <a href="/terms/">Terms</a> &bull; <a href="/privacy/">Privacy</a></div></footer><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-47976921-1', 'auto'); ga('send', 'pageview'); </script> <script type="text/javascript" src="/static/js/5144fa7c240f10a938aa602665286cab88e986c1.js"></script>
