<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- meta info -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="format-detection" content="telephone=no">
    <!-- favicon and webapp behaviour -->
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#343a40">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Groveld">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple/apple-touch-icon.png">
    <link rel="mask-icon" href="/static/icons/apple/safari-pinned-tab.svg" color="#343a40">
    <!-- site info -->
    <meta name="description" content="How To Use Gitolite to Control Access to a Git Server on an Debian 7.0 VPS">
    <meta name="author" content="groveld">
    <link rel="alternate" type="application/atom+xml" title="Martin Groeneveld" href="/atom.xml">
    <link rel="canonical" href="https://www.groveld.com/articles/use-gitolite-to-control-access-to-a-git-server">
    <title>Use Gitolite to Control Access to a Git Server - Martin Groeneveld</title>
    <!-- Bootstrap CSS, Custom CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/style.css">

    <script>
  // Register Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      // ServiceWorker registration successful
    }).catch(function(err) {
      console.log('ServiceWorker registration failed:', err);
    });
  }
  // Enable A2HS prompt
  window.addEventListener('beforeinstallprompt', async e => {
    await e.prompt();
  });
</script>

  </head>
  <body>
    
<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark mb-2">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="/static/images/logo.png" width="30" height="30" class="d-inline-block align-top mr-1" alt="logo">
      Martin Groeneveld
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbar">
      <div class="navbar-nav ml-auto">
        <a class="nav-item nav-link active" href="/blog">Blog</a>
        <a class="nav-item nav-link" href="/about">About</a>
        <a class="nav-item nav-link" href="/contact">Contact</a>
      </div>
    </div>
  </div>
</nav>


    <div class="container-fluid">

  <div class="row">
    <div class="col">
      <div class="card my-3">
        <div class="card-body">
          <h1 class="card-title">Use Gitolite to Control Access to a Git Server</h1>
          <p>Git is a great distributed version control system that can be used to keep track of changes and code for any kind of project. Sometimes, it is helpful to configure a git server to house your team’s projects.</p>

<p><strong>Gitolite</strong> provides an access-control layer for a git server, so that you can configure user-based git access without the accompanying operating system user accounts. This provides your git contributors the privileges they need, without exposing your server to other kinds of interaction.</p>

<p>We will be installing these components on an Debian 7.0 VPS. This tutorial assumes that you have a regular user account on this VPS with sudo privileges.</p>

<h2 id="install-git">Install Git</h2>

<p>Log into your Debian server with your regular user account.</p>

<p>We will be installing git from Debian’s default repositories:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>git-core
</code></pre></div></div>

<p>We now have git installed. We will want to configure a few things for git to operate properly.</p>

<h2 id="install-gitolite">Install Gitolite</h2>

<p>Now that we have git set up correctly, we can install gitolite to manage user access to our repositories.</p>

<p>Gitolite is also available in Debian’s default repositories. Install it with this command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>gitolite
</code></pre></div></div>

<p>Gitolite manages its configuration through git! To set this up properly, we’ll create a operating system user whose sole function is to interact with gitolite.</p>

<p>The operating system user will be called <code class="highlighter-rouge">git</code> to make it easy for our collaborators to remember. We will not set a password so that it is only accessible through using the <code class="highlighter-rouge">su</code> command.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>adduser <span class="nt">--system</span> <span class="nt">--group</span> <span class="nt">--shell</span> /bin/bash <span class="nt">--disabled-password</span> git
</code></pre></div></div>

<p>We now have a user called “git” that will handle gitolite configuration. We need to be able to access this user from a normal account. We will do this by configuring an SSH key associated with git administration.</p>

<h2 id="configure-ssh-keys-for-git-administration">Configure SSH Keys for Git Administration</h2>
<p>On your <strong>local computer</strong>, which you will be using to administer git and gitolite, you need to create an SSH key pair if you have not done so already.</p>

<p><strong><em>Note:</em></strong> <em>If you already have a key pair created, you should skip this command to avoid overwriting your SSH keys.</em></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> rsa
</code></pre></div></div>

<p>Accept the default location and press <code class="highlighter-rouge">ENTER</code> to configure key-based login without a password.</p>

<p>Copy the public key to the git server by typing:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp ~/.ssh/id_rsa.pub regular_username@git_server_IP_address:/tmp/git-admin.pub
</code></pre></div></div>

<p>If you followed the Initial Server Setup article, you will need to allow SSH access to the git user. You can do that by editing <code class="highlighter-rouge">/etc/ssh/sshd_config</code> and adding git to the <code class="highlighter-rouge">AllowUsers</code> directive. Once you’re done, restart the SSH server:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>service ssh restart
</code></pre></div></div>

<h2 id="configure-gitolite">Configure Gitolite</h2>
<p>The next steps will take place back on our git server. Log back in with your normal user.</p>

<p>We can log in with our “git” user to initialize gitolite with the public key we just transferred.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>su - git
</code></pre></div></div>

<p>Now, we can set up gitolite with the following command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gl-setup /tmp/git-admin.pub
</code></pre></div></div>

<p>Hit <code class="highlighter-rouge">ENTER</code> to pull the configuration into your editor. Scan the contents to make sure the default configuration will meet your needs. You can always change it later.</p>

<p>When you are finished, save and exit out of the file.</p>

<h2 id="how-to-administer-gitolite">How To Administer Gitolite</h2>
<p>Back on your <strong>local</strong> computer, you can begin administering gitolite.</p>

<p>If you do not already have git installed on this computer, you need to install it with:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>git-core
</code></pre></div></div>

<p>First, we need to clone the gitolite information from our git server to our local machine:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@git_server_IP_address:gitolite-admin
</code></pre></div></div>

<p>This will create a new directory called <code class="highlighter-rouge">gitolite-admin</code> within your current directory. Here, we can make changes to our access policies and then push those changes to the git server.</p>

<h2 id="add-new-users-to-gitolite">Add New Users to Gitolite</h2>
<p>To add users to your projects, you will need their public keys. Gitolite works by associating the username that will be signing in with the public key with the same name. We will pretend we have a user called <code class="highlighter-rouge">john</code> for this demonstration.</p>

<p>On the local machine, we can change into the <code class="highlighter-rouge">gitolite-admin</code> directory and see what is inside:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>gitolite-admin
<span class="nb">ls</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conf    keydir
</code></pre></div></div>

<p>Inside, there are two directories: <code class="highlighter-rouge">conf</code> and <code class="highlighter-rouge">keydir</code>. Unsurprisingly, <code class="highlighter-rouge">keydir</code> contains user keys.</p>

<p>You would communicate with “john” and acquire the public key that he plans on using. You would then copy that key into this directory like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /path/to/johns/public/key.pub ~/gitolite-admin/keydir/john.pub
</code></pre></div></div>

<p>After that, you need to add the new public key to the git repository.</p>

<p>First, we want to configure the user name and email that will be associated with administrative git actions. Type these commands to configure this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config <span class="nt">--global</span> user.name <span class="s2">"your_name_here"</span>
git config <span class="nt">--global</span> user.email <span class="s2">"your_email@address.com"</span>
</code></pre></div></div>

<p>You probably also want to configure git to use the editor of your choice. Type this command to specify your preferences:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config <span class="nt">--global</span> core.editor your_editor_choice
</code></pre></div></div>

<p>Now, we can add the new file to git:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add keydir/john.pub
</code></pre></div></div>

<p>Commit the changes with a message:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git commit <span class="nt">-a</span> <span class="nt">-m</span> <span class="s2">"New user John added"</span>
</code></pre></div></div>

<p>Push the changes up to the git server to save the results:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push
</code></pre></div></div>

<h2 id="configure-access-with-gitolite">Configure Access with Gitolite</h2>
<p>When you added the user in the last section, you may have noticed a warning like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote:
remote:         <span class="k">*****</span> WARNING <span class="k">*****</span>
remote:         the following <span class="nb">users</span> <span class="o">(</span>pubkey files <span class="k">in </span>parens<span class="o">)</span> <span class="k">do </span>not appear <span class="k">in </span>the config file:
remote: john<span class="o">(</span>john.pub<span class="o">)</span>
</code></pre></div></div>

<p>You will receive a message that the new user is not in the config file. This means that the user “john” is known to gitolite, but no access has been created for him.</p>

<p>We can easily add him to our configuration by editing the <code class="highlighter-rouge">~/gitolite-admin/conf/gitolite.conf</code> file.</p>

<p>We will go one step further though and give him his own repository. We will create a repository called <code class="highlighter-rouge">johns-project</code> and give him access:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano ~/gitolite-admin/conf/gitolite.conf
repo    gitolite-admin
RW+     <span class="o">=</span>   git-admin

repo    testing
RW+     <span class="o">=</span>   @all
</code></pre></div></div>

<p>As you can see, the syntax is pretty simple.</p>

<p>We specify a git repository with the <code class="highlighter-rouge">repo</code> keyword followed by its name. Under that, we write the privilege type, an equal sign (=), and the users who should get that access.</p>

<p>Groups can be defined with a line like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@group_name <span class="o">=</span> user1 user2 user3
</code></pre></div></div>

<p>After that, we can refer to a number of users like by referencing the group:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>repo    some_repo
RW+     <span class="o">=</span> @group_name
</code></pre></div></div>

<p>A special group called <code class="highlighter-rouge">@all</code> references all users or all repositories, based on the context.</p>

<p>The permissions can be one of these values:</p>

<p>R: Read only access
RW: Can read or push new changes. Cannot delete refs that exist on the git server already.
RW+: Can push destructively, or delete refs on the server.
-: Has no access to the specified content.</p>

<p>We can give “john” full access to a new repository called <code class="highlighter-rouge">johns-project</code> by adding these lines to the end of the file:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>repo    johns-project
RW+     <span class="o">=</span>       john
</code></pre></div></div>

<p>Save and close the file.</p>

<p>Now, we can commit this change with a new message:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git commit <span class="nt">-a</span> <span class="nt">-m</span> <span class="s2">"Made John's repo"</span>
</code></pre></div></div>

<p>Finally, push the changes to the git server:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push
</code></pre></div></div>

<p>Now, “john” should be able to clone his project repository with the following command, from the computer where he created the public and private keys:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@git_server_IP_address:johns-project
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>
<p>You should now have gitolite configured correctly. You should be able to create git users easily without worrying about configuring accompanying operating system users and permissions every time.</p>

<p>If you are managing multiple projects with diverse teams, it is probably best to set up groups that correspond to projects. It might also be helpful to organize your <code class="highlighter-rouge">keydir</code> keys into subdirectories based on project. Gitolite will use them the same way, but they will be easier to find for administrative purposes.</p>

        </div>
      </div>
    </div>
  </div>

  

</div>


    <button type="button" class="btn btn-primary" id="scrollUp">Scroll to top</button>

    <footer class="container-fluid my-3">
      <div class="row">
        <div class="col">
          <div class="small text-center">
            &copy; 2018 Martin Groeneveld &bull; <a href="/legal/terms">Terms</a> &bull; <a href="/legal/privacy">Privacy</a> &bull; <a href="/legal/cookies">Cookies</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- jQuery first, then Popper.js, then Bootstrap JS, then custom scripts -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script type="text/javascript" src="/static/js/main.js"></script>
  </body>
</html>
