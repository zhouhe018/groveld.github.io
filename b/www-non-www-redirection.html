<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- meta info -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="format-detection" content="telephone=no">
    <!-- favicon and webapp behaviour -->
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#343a40">
    <!-- <meta name="msapplication-config" content="/browserconfig.xml"> -->
    <!-- <meta name="apple-mobile-web-app-capable" content="yes"> -->
    <!-- <meta name="apple-mobile-web-app-title" content="Groveld"> -->
    <!-- <link rel="apple-touch-icon" sizes="180x180" href="/public/icons/apple/apple-touch-icon.png"> -->
    <!-- <link rel="mask-icon" href="/public/icons/apple/safari-pinned-tab.svg" color="#343a40"> -->
    <!-- site info -->
    <meta name="description" content="The personal website of Martin Groeneveld">
    <meta name="author" content="groveld">
    <link rel="alternate" type="application/atom+xml" title="Martin Groeneveld" href="/atom.xml">
    <link rel="canonical" href="https://www.groveld.com/b/www-non-www-redirection">
    <title>Nginx config for www and non-www redirection - Martin Groeneveld</title>
    <!-- Bootstrap CSS, Custom CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/app.css">
  </head>
  <body>
    
<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark mb-2">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="/static/images/logo.png" width="30" height="30" class="d-inline-block align-top mr-1" alt="logo">
      Martin Groeneveld
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbar">
      <div class="navbar-nav ml-auto">
        <a class="nav-item nav-link active" href="/blog">Blog</a>
        <a class="nav-item nav-link" href="/about">About</a>
        <a class="nav-item nav-link" href="/contact">Contact</a>
      </div>
    </div>
  </div>
</nav>


    <!-- Modal TOC -->
<div class="modal fade" id="modalTOC" tabindex="-1" role="dialog" aria-labelledby="modalTOC" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">Contents</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <ul id="toc">
  <li><a href="#redirect-non-www-to-www">Redirect non-www to WWW</a>
    <ul>
      <li><a href="#single-domain">Single domain</a></li>
      <li><a href="#all-domains">All domains</a></li>
    </ul>
  </li>
  <li><a href="#from-www-to-non-www">From WWW to non-WWW</a>
    <ul>
      <li><a href="#single-domain-1">Single domain</a></li>
      <li><a href="#all-domains-1">All domains</a></li>
    </ul>
  </li>
</ul>
      </div>
    </div>
  </div>
</div>


<div class="container-fluid">

  <div class="row">
    <div class="col">
      <div class="card my-3">
        <div class="card-body">
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalTOC">
            Content
          </button>

          <h1 class="card-title">Nginx config for www and non-www redirection</h1>
          <p>There are many ways to force Nginx to use either WWW version or non-WWW version of URLs for your site.</p>

<h2 id="redirect-non-www-to-www">Redirect non-www to WWW</h2>

<h3 id="single-domain">Single domain</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">example.com</span><span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//www.example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="all-domains">All domains</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">"~^(?!www</span><span class="err">\</span><span class="s">.).*"</span> <span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//www.</span><span class="nv">$host$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="from-www-to-non-www">From WWW to non-WWW</h2>

<h3 id="single-domain-1">Single domain</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">www.example.com</span><span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="all-domains-1">All domains</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">server_name</span> <span class="s">"~^www</span><span class="err">\</span><span class="s">.(.*)</span>$<span class="s">"</span> <span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme</span><span class="p">:</span><span class="n">//</span><span class="nv">$1$request_uri</span> <span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In both cases, for other-www, we create a altogether different server { } block. IMHO, this is cleanest and optimised way to handle www to non-www and non-www to www redirection.</p>

<p>There are some WordPress plugins available there which can handle this at PHP-level. But for performance reason, always handle things in Nginx, that can be handled in Nginx alone!</p>

        </div>
      </div>
    </div>
  </div>

  

</div>


    <button type="button" class="btn btn-primary" id="scrollUp">Scroll to top</button>

    <footer class="container-fluid my-3">
      <div class="row">
        <div class="col">
          <div class="small text-center">
            &copy; 2018 Martin Groeneveld &bull; <a href="/legal/terms">Terms</a> &bull; <a href="/legal/privacy">Privacy</a> &bull; <a href="/legal/cookies">Cookies</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- jQuery first, then Popper.js, then Bootstrap JS, then custom scripts -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script type="text/javascript" src="/static/js/app.js"></script>
  </body>
</html>
